
const utils = require('util');

var fsProxy = require('FileSystemProxy');

var fs = require('fs');
var pathlib = require('path');  
var proxies = [];
function start(root) {
  var configText = fs.readFileSync(pathlib.join(root, "_virtualFileSystem.json"), "utf8");
  var config = JSON.parse(configText);

  var proxyDetails = config.proxies;
  for (let i = 0; i < proxyDetails.length; i++) {
    var proxySettings = proxyDetails[i];
    if (proxySettings.fs) {
      proxySettings.fs = pathlib.resolve(proxySettings.fs);
      var roots = proxySettings.roots;
      let proxy = fsProxy.createProxy(proxySettings);
      if (roots) {
        for (let j = 0; j < roots.length; j++) {
           proxies.push();
        }

      }

    }
    console.log(JSON.stringify(proxySettings));

  }
  
}


function stop() {
}

function getProxy(path) {
  for (var i = 0; i < proxies.length; i++) {
    if (path === proxies[i].root || path.startsWith(proxies[i].rootDir)) {
      return proxies[i];
    }
  }
}

function get(path, success, fail) {
  var proxy = getProxy(path);
  proxy.get(path, success, fail);
}

function getString(path, success, fail) {
  var proxy = getProxy(path);
  proxy.getString(path, success, fail);
}

// Functions which will be available to external callers
exports.start = start;
exports.stop = stop;
exports.get = get;
exports.getString = getString;